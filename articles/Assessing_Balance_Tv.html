<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Assessing Balance for Time-Varying Exposures â€¢ devMSMs</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="Assessing_Balance_Tv_files/libs/quarto-html/popper.min.js"></script><script src="Assessing_Balance_Tv_files/libs/quarto-html/tippy.umd.min.js"></script><link href="Assessing_Balance_Tv_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Assessing_Balance_Tv_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Assessing Balance for Time-Varying Exposures">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">devMSMs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Terminology.html">Terminology</a></li>
    <li><a class="dropdown-item" href="../articles/Specify_Core_Inputs.html">Specify Core Inputs</a></li>
    <li><a class="dropdown-item" href="../articles/Data_Requirements.html">Data Requirements &amp; Preparation</a></li>
    <li><a class="dropdown-item" href="../articles/Workflow_Continuous_Exposure.html">Workflow for Continous Exposures</a></li>
    <li><a class="dropdown-item" href="../articles/Assessing_Balance_Tv.html">Assessing Balance for Time-Varying Exposures</a></li>
    <li><a class="dropdown-item" href="../articles/Customize_Balancing_Formulas.html">Customizing Weights Formulas</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/istallworthy/devMSMs/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Assessing Balance for Time-Varying Exposures</h1>


      <p class="date">2025-09-02</p>

      <small class="dont-index">Source: <a href="https://github.com/istallworthy/devMSMs/blob/main/vignettes/Assessing_Balance_Tv.qmd" class="external-link"><code>vignettes/Assessing_Balance_Tv.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <p>Assessing balance for time-varying exposures is a topic that has not been extensively examined in the MSM literature. However, Jackson (2016) has established guidance that we draw on for this package, implemented in the <code>calcBalStats()</code> function (drawn on by the <code><a href="../reference/assessBalance.html">assessBalance()</a></code> function) in <em>devMSMs</em>.</p>
<section class="level2"><h2 id="calculating-raw-balance-statistics">Calculating Raw Balance Statistics<a class="anchor" aria-label="anchor" href="#calculating-raw-balance-statistics"></a>
</h2>
<p><code>calcBalStats()</code> assesses balance using correlations between confounder and exposure for continuous exposures and standardized mean differences of the confounder between exposure groups for binary exposures. These balancing statistics are created based on the diagnostics for confounding of time-varying exposures outlined by Jackson (2016). More specifically, at each user-specified exposure time point, raw balance statistics are calculated to quantify the association between exposure at that time point and each confounder, for each exposure history up until that time point. This is accomplished using the <code>col_w_cov()</code> function to calculate covariance for continuous exposures and the <code>col_w_smd()</code> function to calculate mean difference for binary exposures from the <em>cobalt</em> package (Greifer, 2023). Factor covariates are split into separate dummy variables using the <code>splitfactor()</code> function from cobalt. Any covariate interactions present in the formulas are created in the data by multiplying the constituent variables, with interactions including factor covariates implemented by constituent dummy variables.</p>
</section><section class="level2"><h2 id="weighting-balance-statistics-by-exposure-history">Weighting Balance Statistics By Exposure History<a class="anchor" aria-label="anchor" href="#weighting-balance-statistics-by-exposure-history"></a>
</h2>
<p>In the <code>calcBalStats()</code> function, exposure histories comprise all combinations of the presence and absence of exposure (delineated using a median split for continuous exposures) at all prior time points (note that these may be different from the user-specified, substantive exposure histories used to compare dose and timing in the final model; Workflow Step 6). Subsequently, a weighted mean of the balance statistics, weighted by the proportion of individuals in that exposure history, provides a raw estimate of balance between exposure at that time point for each confounder. On the occasion that there are balancing statistics for only one person or no people in a given exposure history, the user is alerted and that balance statistic is dropped from inclusion. These raw (unstandardized) balance statistics are calculated without IPTW weights for pre-balance checking and using the IPTW balancing weights (that have been multiplied across time points) for weighted analyses.</p>
</section><section class="level2"><h2 id="standardizing-balance-statistics">Standardizing Balance Statistics<a class="anchor" aria-label="anchor" href="#standardizing-balance-statistics"></a>
</h2>
<p>For the purpose of comparison to each other and to a common balance threshold, balancing statistics are then similarly standardized in the following manner. For continuous exposures, the raw balance statistic (covariance) is divided by the product of the standard deviation of the unweighted confounder and the standard deviation of the exposure at that time point to calculate the correlation. Given this, it is possible that the correlation may be greater than 1.</p>
<p>For binary exposures, the raw balance statistic (mean difference) is divided by a pooled standard deviation estimate, or the square root of the average of the standard deviations of the unweighted confounder levels for the exposed and unexposed groups at the first exposure time point. All standard deviations are computed using the unadjusted sample (as recommended by Stuart, 2008; 2010; Greifer, 2022) given the possibility that balancing changes the variation in a confounder and leads to misleading standardized values. At the first exposure time point (when there are no histories), standardized balance statistics are computed directly using the same cobalt functions mentioned above.</p>
</section><section class="level2"><h2 id="imputed-data">Imputed Data<a class="anchor" aria-label="anchor" href="#imputed-data"></a>
</h2>
<p>If imputed data are supplied, the above process is conducted on each imputed dataset separately. The function then takes the average of the absolute values of the balance statistics across imputed datasets to account for sampling error (Pishgar et al., 2021 preprint). These averaged average balance statistics are then compared to the balance threshold(s) to summarize which covariates are balanced. Recommended specification of separate balance thresholds for relatively more and less important confounders can be found in the <em>Workflows</em> vignettes. The specification of balance threshold(s) should be kept consistent throughout the use of the <em>devMSMs</em> package.</p>
</section><section class="level2"><h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Greifer, N. (2024). cobalt: Covariate Balance Tables and Plots (4.4.1) [Computer software]. https://CRAN.R-project.org/package=cobalt</p>
<p>Jackson, J. W. (2016). Diagnostics for Confounding of Time-varying and Other Joint Exposures. Epidemiology, 27(6), 859. https://doi.org/10.1097/EDE.0000000000000547</p>
<p>Pishgar, F., Greifer, N., Leyrat, C., &amp; Stuart, E. (2021). MatchThem: Matching andWeighting after Multiple Imputation. R Journal, 13(2), 292â€“305. https://doi.org/10.32614/RJ-2021-073</p>
<p>Stuart, E. A. (2008). Developing practical recommendations for the use of propensity scores: Discussion of â€˜A critical appraisal of propensity score matching in the medical literature between 1996 and 2003â€™ by Peter Austin, Statistics in Medicine. Statistics in Medicine, 27(12), 2062â€“2065. https://doi.org/10.1002/sim.3207</p>
<p>Stuart, E. A. (2010). Matching methods for causal inference: A review and a look forward. Statistical Scienceâ€¯: A Review Journal of the Institute of Mathematical Statistics, 25(1), 1â€“21. https://doi.org/10.1214/09-STS313</p>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Isabella Stallworthy, Noah Greifer, Meriah DeJoseph, Emily Padrutt, Kyle Butts, Daniel Berry.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
